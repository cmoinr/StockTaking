<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Búsqueda Avanzada por Característica</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Búsqueda Avanzada por Característica</h1>
        <form action="{{ url_for('busqueda_avanzada1') }}" method="get" style="margin-bottom:10px;">
            <label>Característica:</label>
            <input type="text" name="caracteristica" placeholder="Ej: color" list="caracteristicas-list" id="caracteristica-input">
            <datalist id="caracteristicas-list"></datalist>
            <label>Valor:</label>
            <input type="text" name="valor" placeholder="Ej: rojo" list="valores-list" id="valor-input">
            <datalist id="valores-list"></datalist>
            <button type="submit">Buscar por característica</button>
        </form>
        <ul>
            {% for p in productos %}
                <li>{{ p['nombre'] }} ({{ caracteristica }}: {{ p['caracteristicas'][caracteristica] }})</li>
            {% else %}
                <li>No se encontraron productos.</li>
            {% endfor %}
        </ul>
        <a href="{{ url_for('index') }}">Volver al inventario</a>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Autocompletar características
            fetch("{{ url_for('caracteristicas_unicas') }}")
                .then(response => response.json())
                .then(data => {
                    const datalist = document.getElementById('caracteristicas-list');
                    datalist.innerHTML = '';
                    data.forEach(car => {
                        const option = document.createElement('option');
                        option.value = car;
                        datalist.appendChild(option);
                    });
                });

            // Autocompletar valores según característica seleccionada
            const carInput = document.getElementById('caracteristica-input');
            const valInput = document.getElementById('valor-input');
            carInput.addEventListener('input', function() {
                const car = carInput.value;
                if (car.length > 0) {
                    fetch(`/valores_caracteristica?caracteristica=${encodeURIComponent(car)}`)
                        .then(response => response.json())
                        .then(data => {
                            const vlist = document.getElementById('valores-list');
                            vlist.innerHTML = '';
                            data.forEach(val => {
                                const option = document.createElement('option');
                                option.value = val;
                                vlist.appendChild(option);
                            });
                        });
                }
            });
        });
    </script>
</body>
</html>
